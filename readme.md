# TamperMonkey расширение для синхронизации прогресса чтения манги между платформами

## Описание
Этот проект представляет собой TamperMonkey расширение, которое позволяет отслеживать прогресс чтения манги на различных платформах и находить альтернативные источники с большим количеством глав.

## Поддерживаемые платформы
- MangaLib.me
- Senkuro.com
- MangaBuff.ru
- ReadManga.io (Mintmanga)
- Inkstory.me (ранее Manga.ovh)

## Основные возможности
- Автоматическая синхронизация прогресса чтения между платформами
- Поиск альтернативных источников манги
- Отображение количества доступных глав на других платформах
- Автоматический переход на следующую главу при прокрутке страницы

## Известные проблемы
В настоящее время известных критичных проблем нет. При обнаружении багов создавайте [issue](https://github.com/FrostBy/manga-helper/issues).

## Лицензия и поддержка
Код распространяется с возможностью использования, модификации и распространения с указанием авторства.

**Важно:** Коммерческое использование требует явного разрешения автора. По вопросам обращайтесь на frost.by@gmail.com.

Поддержать разработку можно через [Buy Me a Coffee](https://www.buymeacoffee.com/frostby).

## Разработка

### Требования
- Node.js (рекомендуется последняя LTS версия)
- TamperMonkey или аналогичный менеджер userscript'ов

### Настройка окружения

1. **Разрешите TamperMonkey доступ к локальным файлам**

   Следуйте инструкции: [TamperMonkey FAQ](https://tampermonkey.net/faq.php?ext=dhdg#Q204)

2. **Установите зависимости**
   ```bash
   npm i
   # или
   npm ci
   ```

3. **Запустите режим разработки**
   ```bash
   npm run dev
   ```

   После этого в папке `./dist/` появятся два файла:

   - **`dist/index.dev.user.js`** - установите этот userscript в браузер. Это простой загрузчик, который подгружает `dist/index.debug.js` на нужных страницах.
   - **`dist/index.debug.js`** - сборка для разработки с source maps. Автоматически загружается через `@require file://.../dist/index.debug.js`. **Не добавляйте его в менеджер userscript'ов вручную.**

4. **Редактируйте код**

   Основная точка входа: `src/index.ts`

   Вы можете импортировать CSS, LESS и SCSS файлы прямо в TypeScript.

5. **Используйте livereload** (опционально)

   Для автоматической перезагрузки при изменениях используйте [Chrome расширение](https://chrome.google.com/webstore/detail/jnihajbhpnppcggbcgedagnkighmdlei)

### Важно

При изменении метаданных userscript'а (`config/metadata.cjs`) необходимо:
1. Перезапустить webpack сервер (`npm run dev`)
2. Заново установить обновленный `dist/index.dev.user.js` в браузере

## Сборка для production

```bash
npm run build
```

Результат сборки: `dist/index.prod.user.js` - готовый скрипт для публикации на GreasyFork или других платформах.

### Минификация

В соответствии с [правилами GreasyFork](https://greasyfork.org/en/help/code-rules), код не должен быть обфусцирован или минифицирован. Минификация отключена по умолчанию.

## Структура проекта

```
src/
├── common/           # Общие компоненты и утилиты
│   ├── DB.ts        # Работа с хранилищем
│   ├── Logger.ts    # Система логирования
│   └── ...
├── platforms/       # Реализации для каждой платформы
│   ├── mangalib.me/
│   ├── senkuro.com/
│   └── ...
└── index.ts         # Точка входа
```

## TypeScript

Проект полностью написан на TypeScript.

## Зависимости

### UserScript способ
Некоторые библиотеки подключаются через `@require` в [metadata.cjs](./config/metadata.cjs) и исключаются из bundle в [webpack.config.base.cjs](./config/webpack.config.base.cjs).

### Webpack способ
Большинство зависимостей устанавливаются через npm и бандлятся webpack'ом.

## Автоматический деплой

GitHub Actions автоматически деплоит production сборку в ветку `gh-pages`.

Результат доступен по адресу: `https://frostby.github.io/manga-helper/index.prod.user.js`

Можно использовать с функцией автообновления GreasyFork.

## Вопросы и ответы

**Q: Source maps не работают в production?**

A: TamperMonkey добавляет дополнительные строки (`@require`) перед вашим скриптом, что сбивает маппинг. Используйте `devtool` с префиксом `eval` для разработки.

## Вклад в разработку

Pull requests приветствуются! Для крупных изменений сначала создайте issue для обсуждения.

## Автор

FrostBy - [GitHub](https://github.com/FrostBy)
